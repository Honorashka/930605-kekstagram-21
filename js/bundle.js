(()=>{"use strict";(()=>{const e=["Сергей","Полина","Ксюша","Марина","Николай","Александр","Денис","Анотн"],t=["Все отлично","Моя бабушка случайно чихнула с фотоаппаратом в руках и у неё получилась фотография лучше.","В целом всё неплохо. Но не всё.","Когда вы делаете фотографию, хорошо бы убирать палец из кадра. В конце концов это просто непрофессионально.","Я поскользнулся на банановой кожуре и уронил фотоаппарат на кота и у меня получилась фотография лучше.","Лица у людей на фотке перекошены, как будто их избивают. Как можно было поймать такой неудачный момент?!"];window.hashtag={MIN_LENGTH_HASHTAG:2,MAX_LENGHT_HASHTAG:20},window.scale={STEP:25,MIN_SCALE:25,MAX_SCALE:100};const n=()=>{const n=[];for(let o=0;o<2;o++)n.push({avatar:"img/avatar-"+i(1,6)+".svg",message:c(t),name:c(e)});return n},o=[],i=(e,t)=>Math.floor(e+Math.random()*(t+1-e)),c=e=>e[i(0,e.length-1)];window.data={renderPhotoBlock:()=>{for(let e=0;e<25;e++)o.push({url:`photos/${e+1}.jpg`,description:"Описание фотографии",likes:i(15,200),comments:n()});return o}}})(),window.load=function(e,t){const n=new XMLHttpRequest;n.responseType="json",n.open("GET","https://21.javascript.pages.academy/kekstagram/data"),n.addEventListener("load",(function(){const o=n.response;200===n.status?e(n.response):t("Статус ответа"+n.status+" "+n.statusText),window.load={dataServerArr:o}})),n.addEventListener("error",(function(){t("Произошла ошибка соединения")})),n.addEventListener("timeout",(function(){t("Запрос не усел выполниться за "+n.timeout+"мс")})),n.timeout=1e4,n.send()},window.upload=function(e,t,n){const o=new XMLHttpRequest;o.responseType="json",o.addEventListener("load",(function(){t(o.response)})),o.addEventListener("error",(function(){n()})),o.addEventListener("timeout",(function(){n("Запрос не усел выполниться за "+o.timeout+"мс")})),o.timeout=3e3,o.open("POST","https://21.javascript.pages.academy/kekstagram"),o.send(e)},(()=>{const e=document.querySelector(".pictures"),t=document.querySelector("#picture").content.querySelector(".picture"),n=document.querySelector(".social__comment"),o=document.querySelector(".social__comments"),i=document.createDocumentFragment(),c=e=>{const n=t.cloneNode(!0);return n.querySelector(".picture__img").src=e.url,n.querySelector(".picture__likes").textContent=e.likes,n.querySelector(".picture__comments").textContent=e.comments.length,n},r=function(t){for(let e=0;e<t.length;e++)i.appendChild(c(t[e]));e.appendChild(i)};window.load(r,(function(e){const t=document.createElement("div");t.style="z-index: 100; margin: 0 auto; text-align: center; background-color: red;",t.style.position="absolute",t.style.left=0,t.style.right=0,t.style.fontSize="30px",t.textContent=e,document.body.insertAdjacentElement("afterbegin",t)})),window.picture={renderComments:e=>{e.forEach((e=>{const t=n.cloneNode(!0);t.querySelector(".social__picture").src=e.avatar,t.querySelector(".social__picture").alt=e.name,t.querySelector(".social__text").textContent=e.message,o.appendChild(t),t.classList.add("hidden")}))},pictureNode:e,socialComments:o,successHundler:r}})(),(()=>{const e=document.querySelector(".big-picture"),t=document.querySelector(".big-picture__img").querySelector("img"),n=document.querySelector(".likes-count"),o=document.querySelector(".comments-count"),i=document.querySelector(".social__caption"),c=document.querySelector("#picture-cancel"),r=document.querySelector(".pictures"),s=document.querySelector(".comments-loader"),d=document.querySelector(".social__comments"),l=(c,r)=>{const l=c[r];t.src=l.url,n.textContent=l.likes,o.textContent=l.comments.length,i.textContent=l.description,window.picture.renderComments(l.comments),e.classList.remove("hidden"),s.classList.remove("hidden");let a=[];a=l.comments;const u=(e,t)=>{for(let n=0;n<e;n++)t[n].classList.remove("hidden")},m=d.querySelectorAll(".social__comment");let w=5;const p=(e,t,n)=>{e<t.length?(u(e,n),s.classList.remove("hidden")):(u(t.length,n),s.classList.add("hidden"))};p(w,m,m),s.addEventListener("click",(()=>{w+=5,p(w,a,m)}))};document.querySelector(".social__comment-count").classList.add("hidden");const a=e=>{const t=r.querySelectorAll(".picture");return Array.from(t).indexOf(e)},u=e=>{window.picture.socialComments.textContent="";const t=e.target.closest(".picture");if(t){const e=a(t);document.querySelector("body").classList.add("modal-open");const n=window.load.dataServerArr;l(n,e)}};window.preview={bigPicture:e,onItemOpen:u,closeItems:()=>{e.classList.add("hidden"),document.querySelector("body").classList.remove("modal-open"),window.picture.socialComments.textContent="",window.picture.pictureNode.removeEventListener("keydown",window.button.onButtonEscapeItem),window.picture.pictureNode.removeEventListener("click",u)},buttonPictureItems:c,onFilterItemOpenClick:e=>{window.picture.socialComments.textContent="";const t=e.target.closest(".picture");if(t){const e=a(t);document.querySelector("body").classList.add("modal-open");const n=window.filter.preparedPosts;l(n,e)}},indexPictureImage:a,showBigPicture:l}})(),window.debounce=function(e){let t=null;return function(...n){t&&window.clearTimeout(t),t=window.setTimeout((function(){e(...n)}),500)}},(()=>{const e=document.querySelector(".img-filters"),t=document.querySelector("#filter-default"),n=document.querySelector("#filter-random"),o=document.querySelector("#filter-discussed"),i=e.querySelectorAll(".img-filters__button");e.classList.remove("img-filters--inactive");const c=e=>{for(;document.querySelector(".picture");)document.querySelector(".picture").remove();window.picture.successHundler(e)},r=window.debounce((function(){i.forEach((e=>e.classList.remove("img-filters__button--active"))),t.classList.add("img-filters__button--active"),c(window.load.dataServerArr),window.picture.pictureNode.addEventListener("click",window.preview.onItemOpen),window.picture.pictureNode.removeEventListener("click",window.preview.onFilterItemOpenClick),window.picture.pictureNode.removeEventListener("keydown",window.button.onButtonFilterEnterItem)})),s=window.debounce((function(){i.forEach((e=>e.classList.remove("img-filters__button--active"))),n.classList.add("img-filters__button--active"),(()=>{const e=[...window.load.dataServerArr];e.sort((function(){return.5-Math.random()}));const t=e.slice(0,10);c(t),window.picture.pictureNode.removeEventListener("click",window.preview.onItemOpen),window.picture.pictureNode.removeEventListener("keydown",window.button.onButtonEnterItem),window.picture.pictureNode.addEventListener("keydown",window.button.onButtonFilterEnterItem),window.picture.pictureNode.addEventListener("click",window.preview.onFilterItemOpenClick),window.filter={preparedPosts:e}})()})),d=window.debounce((function(){i.forEach((e=>e.classList.remove("img-filters__button--active"))),o.classList.add("img-filters__button--active"),(()=>{const e=[...window.load.dataServerArr],t=e.sort((function(e,t){return e.comments.length>t.comments.length?-1:e.comments.length<t.comments.length?1:0}));c(t),window.picture.pictureNode.removeEventListener("keydown",window.button.onButtonEnterItem),window.picture.pictureNode.removeEventListener("click",window.preview.onItemOpen),window.picture.pictureNode.addEventListener("keydown",window.button.onButtonFilterEnterItem),window.picture.pictureNode.addEventListener("click",window.preview.onFilterItemOpenClick),window.filter={preparedPosts:e}})()}));t.addEventListener("click",r),n.addEventListener("click",s),o.addEventListener("click",d)})(),(()=>{const e=(e,t)=>{if("picture"===e.target.className){const n=e.target.querySelector(".picture");if(13===e.keyCode&&n){const e=window.preview.indexPictureImage(n),o=t;window.preview.showBigPicture(o,e),document.querySelector("body").classList.add("modal-open")}}};window.button={onButtonEscapeItem:e=>{27===e.keyCode&&(window.preview.bigPicture.classList.add("hidden"),document.querySelector("body").classList.remove("modal-open"),window.picture.socialComments.textContent="")},onButtonEnterItem:t=>{e(t,window.load.dataServerArr)},onButtonFilterEnterItem:t=>{e(t,window.filter.preparedPosts)},BUTTON_ESCAPE:27,onButtonEscapeCancel:e=>{e.keyCode===window.button.BUTTON_ESCAPE&&document.activeElement!==window.validation.inputHashTags&&document.activeElement!==window.validation.textAreaComment&&window.effects.closeEditWindow()}}})(),(()=>{const e=document.querySelectorAll(".effects__radio"),t=document.querySelector(".img-upload__preview").querySelector("img"),n=document.querySelector(".effect-level__pin"),o=document.querySelector(".effect-level__depth"),i=document.querySelector(".effect-level__line"),c=document.querySelector(".effect-level"),r=document.querySelector("#upload-cancel"),s=document.querySelector("#upload-file"),d=document.querySelector(".img-upload__overlay"),l=["effects__preview--none","effects__preview--chrome","effects__preview--sepia","effects__preview--marvin","effects__preview--phobos","effects__preview--heat"],a=["none","grayscale(1)","sepia(1)","invert(100%)","blur(3px)","brightness(3)"],u=(e,n,o)=>{e.addEventListener("click",(function(){t.className=n,t.style.filter=o,m()}))};for(let t=0;t<e.length;t++)u(e[t],l[t],a[t]),c.classList.add("hidden");const m=()=>{t.classList.contains("effects__preview--none")?(c.classList.add("hidden"),t.style.filter="none"):t.classList.contains("effects__preview--^")||(n.style.left="100%",o.style.width="100%",c.classList.remove("hidden"))};n.addEventListener("mousedown",(e=>{const c=parseFloat(getComputedStyle(i).width);e.preventDefault();let r={x:e.clientX},s=!1;const d=e=>{e.preventDefault(),s=!0;const i=r.x-e.clientX;r={x:e.clientX};const d=(n.offsetLeft-i)/c;var l;d>=0&&d<=1&&(l=d,n.style.left=Math.round(100*l)+"%",o.style.width=Math.round(100*l)+"%",t.classList.contains("effects__preview--none")?t.style.filter="none":t.classList.contains("effects__preview--chrome")?t.style.filter=`grayscale(${parseFloat(n.style.left)/100})`:t.classList.contains("effects__preview--sepia")?t.style.filter=`sepia(${parseFloat(n.style.left)/100})`:t.classList.contains("effects__preview--marvin")?t.style.filter=`invert(${n.style.left})`:t.classList.contains("effects__preview--phobos")?t.style.filter=`blur(${parseFloat(n.style.left)/(100/3)}px)`:t.classList.contains("effects__preview--heat")&&(t.style.filter=`brightness(${Math.round(parseFloat(n.style.left)/50+1)})`))},l=e=>{if(e.preventDefault(),document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",l),s){const e=function(t){t.preventDefault(),n.removeEventListener("click",e)};n.addEventListener("click",e)}};document.addEventListener("mousemove",d),document.addEventListener("mouseup",l)})),window.effects={imgUploadPreview:t,uploadCancel:r,uploadFile:s,uploadOverlay:d,openEditWindow:()=>{d.classList.remove("hidden"),document.querySelector("body").classList.add("modal-open"),document.addEventListener("keydown",window.button.onButtonEscapeCancel)},closeEditWindow:()=>{d.classList.add("hidden"),document.querySelector("body").classList.remove("modal-open"),s.value="",t.className="effects__preview--none",m()}}})(),window.effects.uploadFile.addEventListener("change",window.effects.openEditWindow),window.effects.uploadCancel.addEventListener("click",window.effects.closeEditWindow),window.picture.pictureNode.addEventListener("click",window.preview.onItemOpen),window.preview.buttonPictureItems.addEventListener("click",window.preview.closeItems),window.picture.pictureNode.addEventListener("keydown",window.button.onButtonEnterItem),window.picture.pictureNode.addEventListener("keydown",window.button.onButtonEscapeItem),(()=>{const e=document.querySelector(".scale__control--value"),t=document.querySelector(".scale__control--smaller"),n=document.querySelector(".scale__control--bigger"),o=t=>{t-window.scale.STEP<window.scale.MIN_SCALE?(e.value=window.scale.MIN_SCALE+"%",window.effects.imgUploadPreview.style.transform=`scale(${window.scale.MIN_SCALE/100})`):t+window.scale.STEP>window.scale.MAX_SCALE?(e.value=window.scale.MAX_SCALE+"%",window.effects.imgUploadPreview.style.transform=`scale(${window.scale.MAX_SCALE/100})`):(e.value=t+"%",window.effects.imgUploadPreview.style.transform=`scale(${t/100})`)};t.addEventListener("click",(()=>{const t=e.value;o(parseInt(t,10)-window.scale.STEP)})),n.addEventListener("click",(()=>{const t=e.value;o(parseInt(t,10)+window.scale.STEP)}))})(),(()=>{const e=document.querySelector(".text__hashtags"),t=document.querySelector(".text__description");e.addEventListener("input",(()=>{const t=e.value.split("");for(let n=0;n<t.length;n++){const o=/^#[\w\d]*$/;o.test(t[n]),o.test(t[n])?t[n].length<=window.hashtag.MIN_LENGTH_HASHTAG?e.setCustomValidity("Добавьте "+(window.hashtag.MIN_LENGTH_HASHTAG-t[n].length)+" симв."):t[n].length>window.hashtag.MAX_LENGHT_HASHTAG?e.setCustomValidity("Удалите "+(t[n].length-window.hashtag.MAX_LENGHT_HASHTAG)+" симв."):t.length>=5?e.setCustomValidity("Можно указывать не более 5 хэштегов"):e.setCustomValidity(""):e.setCustomValidity("Хэштег должен начинаться с #, и содержать только буквы и цифры.")}e.reportValidity()})),window.validation={inputHashTags:e,textAreaComment:t}})(),(()=>{const e=document.querySelector(".img-upload__form"),t=document.querySelector("main"),n=document.querySelector("#success").content.querySelector(".success"),o=document.querySelector("#error").content.querySelector(".error"),i=document.createDocumentFragment(),c=()=>{const e=n.cloneNode(!0);i.appendChild(e),t.appendChild(i),document.addEventListener("click",r),document.addEventListener("keydown",l)},r=()=>{document.querySelector(".success").remove(),document.removeEventListener("click",r),document.removeEventListener("keydown",l)},s=()=>{const e=o.cloneNode(!0);i.appendChild(e),t.appendChild(i),document.addEventListener("click",d),document.addEventListener("keydown",a)},d=()=>{document.querySelector(".error").remove(),document.removeEventListener("click",d),document.removeEventListener("keydown",a)},l=e=>{e.keyCode===window.button.BUTTON_ESCAPE&&r()},a=e=>{e.keyCode===window.button.BUTTON_ESCAPE&&d()};e.addEventListener("submit",(t=>{t.preventDefault(),window.upload(new FormData(e),c,s),window.effects.closeEditWindow()}))})()})();